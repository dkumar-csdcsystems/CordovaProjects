!function (a) { "function" == typeof define && define.amd ? define(["jquery", "modernizr"], a) : "object" == typeof exports ? module.exports = a(require("jquery"), window.Modernizr) : window.Shuffle = a(window.jQuery, window.Modernizr) }(function (a, b, c) { "use strict"; function d(a) { return a ? a.replace(/([A-Z])/g, function (a, b) { return "-" + b.toLowerCase() }).replace(/^ms-/, "-ms-") : "" } function s(b, c, d) { var e, f, g, h = null, i = 0; d = d || {}; var j = function () { i = d.leading === !1 ? 0 : a.now(), h = null, g = b.apply(e, f), e = f = null }; return function () { var k = a.now(); i || d.leading !== !1 || (i = k); var l = c - (k - i); return e = this, f = arguments, l <= 0 || l > c ? (clearTimeout(h), h = null, i = k, g = b.apply(e, f), e = f = null) : h || d.trailing === !1 || (h = setTimeout(j, l)), g } } function t(a, b, c) { for (var d = 0, e = a.length; d < e; d++) if (b.call(c, a[d], d, a) === {}) return } function u(b, c, d) { return setTimeout(a.proxy(b, c), d) } function v(a) { return Math.max.apply(Math, a) } function w(a) { return Math.min.apply(Math, a) } function x(b) { return a.isNumeric(b) ? b : 0 } function E(a) { var b, c, d = a.length; if (!d) return a; for (; --d;) c = Math.floor(Math.random() * (d + 1)), b = a[c], a[c] = a[d], a[d] = b; return a } if ("object" != typeof b) throw new Error("Shuffle.js requires Modernizr.\nhttp://vestride.github.io/Shuffle/#dependencies"); var e = b.prefixed("transition"), f = b.prefixed("transitionDelay"), g = b.prefixed("transitionDuration"), h = { WebkitTransition: "webkitTransitionEnd", transition: "transitionend" }[e], i = b.prefixed("transform"), j = d(i), k = b.csstransforms && b.csstransitions, l = b.csstransforms3d, m = !!window.getComputedStyle, n = "shuffle", o = "all", p = "groups", q = 1, r = .001, y = window.getComputedStyle || function () { }, z = function (a, b) { this.x = x(a), this.y = x(b) }; z.equals = function (a, b) { return a.x === b.x && a.y === b.y }; var A = function () { if (!m) return !1; var a = document.body || document.documentElement, b = document.createElement("div"); b.style.cssText = "width:10px;padding:2px;-webkit-box-sizing:border-box;box-sizing:border-box;", a.appendChild(b); var c = y(b, null).width, d = "10px" === c; return a.removeChild(b), d }(), B = 0, C = a(window), D = function (b, c) { c = c || {}, a.extend(this, D.options, c, D.settings), this.$el = a(b), this.element = b, this.unique = "shuffle_" + B++, this._fire(D.EventType.LOADING), this._init(), u(function () { this.initialized = !0, this._fire(D.EventType.DONE) }, this, 16) }; return D.EventType = { LOADING: "loading", DONE: "done", LAYOUT: "layout", REMOVED: "removed" }, D.ClassName = { BASE: n, SHUFFLE_ITEM: "shuffle-item", FILTERED: "filtered", CONCEALED: "concealed" }, D.options = { group: o, speed: 250, easing: "ease-out", itemSelector: "", sizer: null, gutterWidth: 0, columnWidth: 0, delimeter: null, buffer: 0, columnThreshold: m ? .01 : .1, initialSort: null, throttle: s, throttleTime: 300, sequentialFadeDelay: 150, supported: k }, D.settings = { useSizer: !1, itemCss: { position: "absolute", top: 0, left: 0, visibility: "visible" }, revealAppendedDelay: 300, lastSort: {}, lastFilter: o, enabled: !0, destroyed: !1, initialized: !1, _animations: [], _transitions: [], _isMovementCanceled: !1, styleQueue: [] }, D.Point = z, D._getItemTransformString = function (a, b) { return l ? "translate3d(" + a.x + "px, " + a.y + "px, 0) scale3d(" + b + ", " + b + ", 1)" : "translate(" + a.x + "px, " + a.y + "px) scale(" + b + ")" }, D._getNumberStyle = function (b, c, d) { if (m) { d = d || y(b, null); var e = D._getFloat(d[c]); return A || "width" !== c ? A || "height" !== c || (e += D._getFloat(d.paddingTop) + D._getFloat(d.paddingBottom) + D._getFloat(d.borderTopWidth) + D._getFloat(d.borderBottomWidth)) : e += D._getFloat(d.paddingLeft) + D._getFloat(d.paddingRight) + D._getFloat(d.borderLeftWidth) + D._getFloat(d.borderRightWidth), e } return D._getFloat(a(b).css(c)) }, D._getFloat = function (a) { return x(parseFloat(a)) }, D._getOuterWidth = function (a, b) { var c = y(a, null), d = D._getNumberStyle(a, "width", c); if (b) { var e = D._getNumberStyle(a, "marginLeft", c), f = D._getNumberStyle(a, "marginRight", c); d += e + f } return d }, D._getOuterHeight = function (a, b) { var c = y(a, null), d = D._getNumberStyle(a, "height", c); if (b) { var e = D._getNumberStyle(a, "marginTop", c), f = D._getNumberStyle(a, "marginBottom", c); d += e + f } return d }, D._skipTransition = function (a, b, c) { var d = a.style[g]; a.style[g] = "0ms", b.call(c); var e = a.offsetWidth; e = null, a.style[g] = d }, D.prototype._init = function () { this.$items = this._getItems(), this.sizer = this._getElementOption(this.sizer), this.sizer && (this.useSizer = !0), this.$el.addClass(D.ClassName.BASE), this._initItems(), C.on("resize." + n + "." + this.unique, this._getResizeFunction()); var a = this.$el.css(["position", "overflow"]), b = D._getOuterWidth(this.element); this._validateStyles(a), this._setColumns(b), this.shuffle(this.group, this.initialSort), this.supported && u(function () { this._setTransitions(), this.element.style[e] = "height " + this.speed + "ms " + this.easing }, this) }, D.prototype._getResizeFunction = function () { var b = a.proxy(this._onResize, this); return this.throttle ? this.throttle(b, this.throttleTime) : b }, D.prototype._getElementOption = function (a) { return "string" == typeof a ? this.$el.find(a)[0] || null : a && a.nodeType && 1 === a.nodeType ? a : a && a.jquery ? a[0] : null }, D.prototype._validateStyles = function (a) { "static" === a.position && (this.element.style.position = "relative"), "hidden" !== a.overflow && (this.element.style.overflow = "hidden") }, D.prototype._filter = function (a, b) { a = a || this.lastFilter, b = b || this.$items; var c = this._getFilteredSets(a, b); return this._toggleFilterClasses(c.filtered, c.concealed), this.lastFilter = a, "string" == typeof a && (this.group = a), c.filtered }, D.prototype._getFilteredSets = function (b, c) { var d = a(), e = a(); return b === o ? d = c : t(c, function (c) { var f = a(c); this._doesPassFilter(b, f) ? d = d.add(f) : e = e.add(f) }, this), { filtered: d, concealed: e } }, D.prototype._doesPassFilter = function (b, c) { if (a.isFunction(b)) return b.call(c[0], c, this); var d = c.data(p), e = this.delimeter && !a.isArray(d) ? d.split(this.delimeter) : d; return a.inArray(b, e) > -1 }, D.prototype._toggleFilterClasses = function (a, b) { a.removeClass(D.ClassName.CONCEALED).addClass(D.ClassName.FILTERED), b.removeClass(D.ClassName.FILTERED).addClass(D.ClassName.CONCEALED) }, D.prototype._initItems = function (a) { a = a || this.$items, a.addClass([D.ClassName.SHUFFLE_ITEM, D.ClassName.FILTERED].join(" ")), a.css(this.itemCss).data("point", new z).data("scale", q) }, D.prototype._updateItemCount = function () { this.visibleItems = this._getFilteredItems().length }, D.prototype._setTransition = function (a) { a.style[e] = j + " " + this.speed + "ms " + this.easing + ", opacity " + this.speed + "ms " + this.easing }, D.prototype._setTransitions = function (a) { a = a || this.$items, t(a, function (a) { this._setTransition(a) }, this) }, D.prototype._setSequentialDelay = function (a) { this.supported && t(a, function (a, b) { a.style[f] = "0ms," + (b + 1) * this.sequentialFadeDelay + "ms" }, this) }, D.prototype._getItems = function () { return this.$el.children(this.itemSelector) }, D.prototype._getFilteredItems = function () { return this.$items.filter("." + D.ClassName.FILTERED) }, D.prototype._getConcealedItems = function () { return this.$items.filter("." + D.ClassName.CONCEALED) }, D.prototype._getColumnSize = function (b, c) { var d; return d = a.isFunction(this.columnWidth) ? this.columnWidth(b) : this.useSizer ? D._getOuterWidth(this.sizer) : this.columnWidth ? this.columnWidth : this.$items.length > 0 ? D._getOuterWidth(this.$items[0], !0) : b, 0 === d && (d = b), d + c }, D.prototype._getGutterSize = function (b) { var c; return c = a.isFunction(this.gutterWidth) ? this.gutterWidth(b) : this.useSizer ? D._getNumberStyle(this.sizer, "marginLeft") : this.gutterWidth }, D.prototype._setColumns = function (a) { var b = a || D._getOuterWidth(this.element), c = this._getGutterSize(b), d = this._getColumnSize(b, c), e = (b + c) / d; Math.abs(Math.round(e) - e) < this.columnThreshold && (e = Math.round(e)), this.cols = Math.max(Math.floor(e), 1), this.containerWidth = b, this.colWidth = d }, D.prototype._setContainerSize = function () { this.$el.css("height", this._getContainerSize()) }, D.prototype._getContainerSize = function () { return v(this.positions) }, D.prototype._fire = function (a, b) { this.$el.trigger(a + "." + n, b && b.length ? b : [this]) }, D.prototype._resetCols = function () { var a = this.cols; for (this.positions = []; a--;) this.positions.push(0) }, D.prototype._layout = function (a, b) { t(a, function (a) { this._layoutItem(a, !!b) }, this), this._processStyleQueue(), this._setContainerSize() }, D.prototype._layoutItem = function (b, c) { var d = a(b), e = d.data(), f = e.point, g = e.scale, h = { width: D._getOuterWidth(b, !0), height: D._getOuterHeight(b, !0) }, i = this._getItemPosition(h); z.equals(f, i) && g === q || (e.point = i, e.scale = q, this.styleQueue.push({ $item: d, point: i, scale: q, opacity: c ? 0 : 1, skipTransition: c || 0 === this.speed, callfront: function () { c || d.css("visibility", "visible") }, callback: function () { c && d.css("visibility", "hidden") } })) }, D.prototype._getItemPosition = function (a) { for (var b = this._getColumnSpan(a.width, this.colWidth, this.cols), c = this._getColumnSet(b, this.cols), d = this._getShortColumn(c, this.buffer), e = new z(Math.round(this.colWidth * d), Math.round(c[d])), f = c[d] + a.height, g = this.cols + 1 - c.length, h = 0; h < g; h++) this.positions[d + h] = f; return e }, D.prototype._getColumnSpan = function (a, b, c) { var d = a / b; return Math.abs(Math.round(d) - d) < this.columnThreshold && (d = Math.round(d)), Math.min(Math.ceil(d), c) }, D.prototype._getColumnSet = function (a, b) { if (1 === a) return this.positions; for (var c = b + 1 - a, d = [], e = 0; e < c; e++) d[e] = v(this.positions.slice(e, e + a)); return d }, D.prototype._getShortColumn = function (a, b) { for (var c = w(a), d = 0, e = a.length; d < e; d++) if (a[d] >= c - b && a[d] <= c + b) return d; return 0 }, D.prototype._shrink = function (b) { var c = b || this._getConcealedItems(); t(c, function (b) { var c = a(b), d = c.data(); d.scale !== r && (d.scale = r, this.styleQueue.push({ $item: c, point: d.point, scale: r, opacity: 0, callback: function () { c.css("visibility", "hidden") } })) }, this) }, D.prototype._onResize = function () { if (this.enabled && !this.destroyed) { var a = D._getOuterWidth(this.element); a !== this.containerWidth && this.update() } }, D.prototype._getStylesForTransition = function (a) { var b = { opacity: a.opacity }; return this.supported ? b[i] = D._getItemTransformString(a.point, a.scale) : (b.left = a.point.x, b.top = a.point.y), b }, D.prototype._transition = function (b) { var c = this._getStylesForTransition(b); this._startItemAnimation(b.$item, c, b.callfront || a.noop, b.callback || a.noop) }, D.prototype._startItemAnimation = function (b, c, d, e) { function g(b) { b.target === b.currentTarget && (a(b.target).off(h, g), f._removeTransitionReference(i), e()) } var f = this, i = { $element: b, handler: g }; if (d(), !this.initialized) return b.css(c), void e(); if (this.supported) b.css(c), b.on(h, g), this._transitions.push(i); else { var j = b.stop(!0).animate(c, this.speed, "swing", e); this._animations.push(j.promise()) } }, D.prototype._processStyleQueue = function (b) { this.isTransitioning && this._cancelMovement(); var c = a(); t(this.styleQueue, function (a) { a.skipTransition ? this._styleImmediately(a) : (c = c.add(a.$item), this._transition(a)) }, this), c.length > 0 && this.initialized && this.speed > 0 ? (this.isTransitioning = !0, this.supported ? this._whenCollectionDone(c, h, this._movementFinished) : this._whenAnimationsDone(this._movementFinished)) : b || u(this._layoutEnd, this), this.styleQueue.length = 0 }, D.prototype._cancelMovement = function () { this.supported ? t(this._transitions, function (a) { a.$element.off(h, a.handler) }) : (this._isMovementCanceled = !0, this.$items.stop(!0), this._isMovementCanceled = !1), this._transitions.length = 0, this.isTransitioning = !1 }, D.prototype._removeTransitionReference = function (b) { var c = a.inArray(b, this._transitions); c > -1 && this._transitions.splice(c, 1) }, D.prototype._styleImmediately = function (a) { D._skipTransition(a.$item[0], function () { a.$item.css(this._getStylesForTransition(a)) }, this) }, D.prototype._movementFinished = function () { this.isTransitioning = !1, this._layoutEnd() }, D.prototype._layoutEnd = function () { this._fire(D.EventType.LAYOUT) }, D.prototype._addItems = function (a, b, c) { this._initItems(a), this._setTransitions(a), this.$items = this._getItems(), this._shrink(a), t(this.styleQueue, function (a) { a.skipTransition = !0 }), this._processStyleQueue(!0), b ? this._addItemsToEnd(a, c) : this.shuffle(this.lastFilter) }, D.prototype._addItemsToEnd = function (a, b) { var c = this._filter(null, a), d = c.get(); this._updateItemCount(), this._layout(d, !0), b && this.supported && this._setSequentialDelay(d), this._revealAppended(d) }, D.prototype._revealAppended = function (b) { u(function () { t(b, function (b) { var c = a(b); this._transition({ $item: c, opacity: 1, point: c.data("point"), scale: q }) }, this), this._whenCollectionDone(a(b), h, function () { a(b).css(f, "0ms"), this._movementFinished() }) }, this, this.revealAppendedDelay) }, D.prototype._whenCollectionDone = function (b, c, d) { function h(b) { b.target === b.currentTarget && (a(b.target).off(c, h), e++, e === f && (g._removeTransitionReference(i), d.call(g))) } var e = 0, f = b.length, g = this, i = { $element: b, handler: h }; b.on(c, h), this._transitions.push(i) }, D.prototype._whenAnimationsDone = function (b) { a.when.apply(null, this._animations).always(a.proxy(function () { this._animations.length = 0, this._isMovementCanceled || b.call(this) }, this)) }, D.prototype.shuffle = function (a, b) { this.enabled && (a || (a = o), this._filter(a), this._updateItemCount(), this._shrink(), this.sort(b)) }, D.prototype.sort = function (a) { if (this.enabled) { this._resetCols(); var b = a || this.lastSort, c = this._getFilteredItems().sorted(b); this._layout(c), this.lastSort = b } }, D.prototype.update = function (a) { this.enabled && (a || this._setColumns(), this.sort()) }, D.prototype.layout = function () { this.update(!0) }, D.prototype.appended = function (a, b, c) { this._addItems(a, b === !0, c !== !1) }, D.prototype.disable = function () { this.enabled = !1 }, D.prototype.enable = function (a) { this.enabled = !0, a !== !1 && this.update() }, D.prototype.remove = function (b) { function c() { b.remove(), this.$items = this._getItems(), this._updateItemCount(), this._fire(D.EventType.REMOVED, [b, this]), b = null } b.length && b.jquery && (this._toggleFilterClasses(a(), b), this._shrink(b), this.sort(), this.$el.one(D.EventType.LAYOUT + "." + n, a.proxy(c, this))) }, D.prototype.destroy = function () { C.off("." + this.unique), this.$el.removeClass(n).removeAttr("style").removeData(n), this.$items.removeAttr("style").removeData("point").removeData("scale").removeClass([D.ClassName.CONCEALED, D.ClassName.FILTERED, D.ClassName.SHUFFLE_ITEM].join(" ")), this.$items = null, this.$el = null, this.sizer = null, this.element = null, this._transitions = null, this.destroyed = !0 }, a.fn.shuffle = function (b) { var c = Array.prototype.slice.call(arguments, 1); return this.each(function () { var d = a(this), e = d.data(n); e ? "string" == typeof b && e[b] && e[b].apply(e, c) : (e = new D(this, b), d.data(n, e)) }) }, a.fn.sorted = function (b) { var d = a.extend({}, a.fn.sorted.defaults, b), e = this.get(), f = !1; return e.length ? d.randomize ? E(e) : (a.isFunction(d.by) && e.sort(function (b, e) { if (f) return 0; var g = d.by(a(b)), h = d.by(a(e)); return g === c && h === c ? (f = !0, 0) : g < h || "sortFirst" === g || "sortLast" === h ? -1 : g > h || "sortLast" === g || "sortFirst" === h ? 1 : 0 }), f ? this.get() : (d.reverse && e.reverse(), e)) : [] }, a.fn.sorted.defaults = { reverse: !1, by: null, randomize: !1 }, D });